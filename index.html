<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <!-- 
         << CSP(Content-Security-Policy) >>
         : CSPëŠ” ë¸Œë¼ìš°ì €ì—ê²Œ ìŠ¤í¬ë¦½íŠ¸, ìŠ¤íƒ€ì¼, ì´ë¯¸ì§€ ë“±ì„ ì–´ë””ì„œ ì–´ë–»ê²Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì§€ì‹œí•˜ëŠ” ë³´ì•ˆ í—¤ë”ì˜ˆìš”.
           DOMPurify ê°™ì€ HTML í•„í„°ë§ì„ ìš°íšŒí•´ì„œ ê³µê²©ìê°€ <script>ë¥¼ ì‚½ì…í•´ë„, **ë¸Œë¼ìš°ì €ê°€ ì‹¤í–‰ì„ ë§‰ì•„ë²„ë¦´ ìˆ˜ ìˆëŠ” â€œë¸Œë¼ìš°ì € ì°¨ì›ì˜ ë°©ì–´ì„ â€**ì…ë‹ˆë‹¤.

         ğŸ“Œ ì£¼ìš” ëª©ì :
            * XSS ê³µê²© ì‹œë„ ì°¨ë‹¨ (<script>, onerror, eval, data: ë“±)
            * ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ ë¡œë“œ ì œí•œ (cdn, iframe, ì´ë¯¸ì§€ ë“±)
            * ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸/ìŠ¤íƒ€ì¼ ì œí•œ (style="...", <script>alert() ë“±)

         ex) ì˜ˆì‹œ CSP ì„¤ì •(ì¶”ì²œ êµ¬ì„±)
            <meta http-equiv="Content-Security-Policy" content="
              default-src 'self';
              script-src 'self';
              style-src 'self' 'unsafe-inline';
              img-src 'self' data:;
              object-src 'none';
            "> 
         
         âœ… content ë‚´ë¶€ ë””ë ‰í‹°ë¸Œ//ì˜ë¯¸
            1. default-src 'self' // ê¸°ë³¸ ì†ŒìŠ¤ëŠ” í˜„ì¬ ë„ë©”ì¸ë§Œ í—ˆìš©
            2. script-src 'self' // ì™¸ë¶€ JS ë¶ˆí—ˆ (cdn, XSS ì°¨ë‹¨ íš¨ê³¼ ìˆìŒ)
            3. style-src 'self' 'unsafe-inline' // ì™¸ë¶€ ìŠ¤íƒ€ì¼ ë¶ˆí—ˆ, ì¸ë¼ì¸ì€ ì˜ˆì™¸ì ìœ¼ë¡œ í—ˆìš©
            4. img-src 'self' data: // ì´ë¯¸ì§€ì— data URL í—ˆìš©
            5. object-src 'none'	// object, embed ê¸ˆì§€
            6. base-uri 'none' // <base> íƒœê·¸ ê¸ˆì§€
            7. frame-ancestors 'none' // ì´ í˜ì´ì§€ë¥¼ ë‹¤ë¥¸ iframeì—ì„œ ëª» ë¶ˆëŸ¬ì˜´

         ğŸ”’ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸(onclick, eval, <script>)ëŠ” unsafe-inlineì´ ì—†ìœ¼ë©´ ì „ë¶€ ì°¨ë‹¨ë©ë‹ˆë‹¤. ê°€ëŠ¥í•˜ë©´ ì¸ë¼ì¸ ì‚¬ìš©ì„ í”¼í•˜ì„¸ìš”.
         
         +) DOMPurify ì™¸ì— ìì£¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ë³´ì•ˆ í•„í„°ë§
            1. CSP : DOMPurifyì™€ ê°€ì¥ ìì£¼ í•¨ê»˜ ì“°ì´ë©°, ì‹¤í–‰ ìì²´ë¥¼ ë§‰ëŠ” ë³´ì•ˆì±…
            2. X-XSS-Protection (êµ¬í˜•) : ì¼ë¶€ ì˜¤ë˜ëœ ë¸Œë¼ìš°ì €ì—ì„œ XSS í•„í„° í™œì„±í™” (ì§€ê¸ˆì€ ëŒ€ë¶€ë¶„ CSPë¡œ ëŒ€ì²´ë¨)
            3. iframe sandbox	: ìœ ì € ì½˜í…ì¸ ë¥¼ iframeìœ¼ë¡œ ë¶„ë¦¬ ë Œë”ë§ (sandbox ì†ì„±ìœ¼ë¡œ JS ê²©ë¦¬ ê°€ëŠ¥)
            4. ì„œë²„ í•„í„°ë§ : ì„œë²„ì—ì„œë„ sanitize (ì˜ˆ: Python â†’ bleach, PHP â†’ HTMLPurifier, Java â†’ OWASP Java HTML Sanitizer)
            5. WAF(Web Application Firewall) : í´ë¼ìš°ë“œí”Œë ˆì–´, AWS WAF ë“±ì—ì„œ ê³µê²© ì‹œê·¸ë‹ˆì²˜ íƒì§€ í›„ ì°¨ë‹¨
            6. Rate Limiting / Captcha	: ì•…ì„± ìŠ¤íŒ¸ì„± HTML ì…ë ¥ ìì²´ë¥¼ ì°¨ë‹¨ (ë´‡ ì°¨ë‹¨ ëª©ì )
         
         +) ì‹¤ë¬´ì—ì„œ ë§ì´ í•˜ëŠ” êµ¬ì„±(ë‹¤ì¸µ ë°©ì–´)
            1. ì‚¬ìš©ì ì…ë ¥ ì‹œ: DOMPurify.sanitize + Hook â†’ ì¼ì°¨ ì •ì œ
            2. ì €ì¥ ì „ ì„œë²„ ì¸¡ sanitize (ì„ íƒ)
            3. ë Œë”ë§ ì‹œ DOMPurify í•œ ë²ˆ ë”
            4. CSP ì •ì±… ì„¤ì • â†’ ì‹¤í–‰ ì°¨ë‹¨
            5. iframe sandbox ì‚¬ìš© (ì»¤ë®¤ë‹ˆí‹°, ë¸”ë¡œê·¸ ë“±)
            6. WAF + Bot ì°¨ë‹¨ â†’ ëŒ€ëŸ‰ XSS ì‹œë„ íƒì§€
      -->
      <title>Toast UI Plugin Test</title>
      <!-- Editor CSS -->
      <!-- <link rel="stylesheet" href="https://uicdn.toast.com/editor/3.1.5/toastui-editor.min.css" /> -->
      <link rel="stylesheet" href="./src/toast/css/toast-editor.min.css"/>
      <!-- Plugin CSS -->
      <!-- <link rel="stylesheet" href="https://uicdn.toast.com/editor-plugin-table-merged-cell/latest/toastui-editor-plugin-table-merged-cell.min.css" /> -->
      <!-- prismjs Languages -->
      <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" /> -->
      <!-- code syntax highlight -->
      <!-- <link
         rel="stylesheet"
         href="https://uicdn.toast.com/editor-plugin-code-syntax-highlight/latest/toastui-editor-plugin-code-syntax-highlight.min.css"
      /> -->
      <!-- Color Picker -->
      <!-- <link rel="stylesheet" href="https://uicdn.toast.com/tui-color-picker/latest/tui-color-picker.min.css" /> -->
      <!-- color syntax -->
      <!-- <link rel="stylesheet" href="https://uicdn.toast.com/editor-plugin-color-syntax/latest/toastui-editor-plugin-color-syntax.min.css" /> -->
      <link rel="stylesheet" href="./src/toast/css/toast-plugin.min.css"/>

      <!-- TOAST UI Image Editor -->
      <!-- <link rel="stylesheet" href="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.min.css" /> -->
      <link rel="stylesheet" href="./src/toast/css/tui-image-editor.min.css"/>
      <style>
         .tui-image-editor-container .tui-image-editor-controls-logo,
         .tui-image-editor-container .tui-image-editor-header-logo {
            display: none !important;
         }
         #viewer iframe {
            width: 100%;
            height: 500px;
            border: 1px solid #ccc;
         }
      </style>
   </head>
   <body>
      <button type="button" id="send">ì €ì¥</button>
      <div id="editor"></div>
      <div id="image-editor-container" style="display: none"></div>
      <div id="viewer"></div>

      <!-- Color Picker -->
      <!-- <script src="https://uicdn.toast.com/tui-color-picker/latest/tui-color-picker.min.js"></script> -->
      <script src="./src/toast/src/tui-color-picker.min.js"></script>
      <!-- âœ… Core Editor -->
      <!-- <script src="https://uicdn.toast.com/editor/3.1.5/toastui-editor-all.min.js"></script>
      <script src="https://uicdn.toast.com/editor/latest/i18n/ko-kr.js"></script> -->
      <script src="./src/toast/src/toastui-editor-all.min.js"></script>
      <script src="./src/toast/src/ko-kr.js"></script>
      <!-- dompurify -->
      <script src="./src/dompurify/purify.min.js"></script>
      <!-- âœ… Plugin -->
      <!-- <script src="https://uicdn.toast.com/editor-plugin-table-merged-cell/latest/toastui-editor-plugin-table-merged-cell.min.js"></script> -->
      <script src="./src/toast/src/plugin-tableMergedCell.min.js"></script>
      <!-- prismjs Languages -->
      <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-clojure.min.js"></script> -->
      <script src="./src/toast/src/prism.min.js"></script>
      <script src="./src/toast/src/prism-clojure.min.js"></script>
      <!-- code syntax highlight -->
      <!-- <script src="https://uicdn.toast.com/editor-plugin-code-syntax-highlight/latest/toastui-editor-plugin-code-syntax-highlight-all.min.js"></script> -->
      <script src="./src/toast/src/plugin-codeSyntaxHighlightAll.min.js"></script>
      <!-- color syntax -->
      <!-- <script src="https://uicdn.toast.com/editor-plugin-color-syntax/latest/toastui-editor-plugin-color-syntax.min.js"></script> -->
      <script src="./src/toast/src/plugin-colorSyntax.min.js"></script>
      <!-- TOAST UI Image Editor -->
      <!-- <script src="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.min.js"></script> -->
      <!-- ëª‡ê°€ì§€ ì–¸ì–´ í•œêµ­ì–´ë¡œ ë³€ê²½ ë° download ëŒ€ì‹  toast ì—ë””í„°ì— ì‚½ì…ìœ¼ë¡œ ìˆ˜ì • -->
      <script src="./src/toast/src/tui-image-editor.min.js"></script>
      <script>
         DOMPurify.addHook('uponSanitizeAttribute', (node, data) => {
            if (data.attrName === 'style' && /expression\s*\(/i.test(data.attrValue)) {
               data.keepAttr = false;
            }

            if (data.attrName === 'src' && /^data:(text\/html|image\/svg)/i.test(data.attrValue)) {
               data.keepAttr = false;
            }

            /*
               rel="noopener": ìƒˆ ì°½ì´ window.openerë¥¼ í†µí•´ ë¶€ëª¨ í˜ì´ì§€ë¥¼ ì¡°ì‘í•˜ëŠ” ê±¸ ë§‰ìŒ.(íƒ­ ë‚©ì¹˜ ì˜ˆë°©)
               rel="noreferrer": ìƒˆ ì°½ì— ë¶€ëª¨ í˜ì´ì§€ ì£¼ì†Œ(Referrer) ë¥¼ ì•ˆ ë„˜ê¹€.
                                 ì¦‰, ì´ë²ˆ í˜ì´ì§€ì£¼ì†Œê°€ ì „ì†¡ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— í”„ë¼ì´ë²„ì‹œë‚˜ ë¯¼ê°í•œ urlì„ ìƒˆ ì°½ì— ë…¸ì¶œì‹œí‚¤ì§€ ì•ŠìŒ
                                 ê·¸ë ‡ê¸° ë•Œë¬¸ì—, ì™¸ë¶€ ì‚¬ì´íŠ¸ì— ê°œì¸ì •ë³´/ë¹„ê³µê°œ ì£¼ì†Œë¥¼ ë…¸ì¶œì‹œí‚¤ë©´ ì•ˆë˜ê±°ë‚˜, ì™¸ë¶€ íŒŒíŠ¸ë„ˆì—ê²Œ íŠ¸ë˜í”½ ê²½ë¡œë¥¼ ìˆ¨ì‹œê³  ì‹¶ì„ ë•Œ, ê°•ë ¥í•œ ë³´ì•ˆì´ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©ë¨.
                                 
               ì¦‰, ì•…ì„± ë§í¬ê°€ window.opener.location = 'phishing.com' ê°™ì€ ì‹ìœ¼ë¡œ í”¼ì‹± ê³µê²©ì„ í•˜ëŠ” ê±¸ ë°©ì§€.

               noreferrerê°€ noopenerì˜ ê¸°ëŠ¥ë„ í¬í•¨í•˜ê³  ìˆìŒ.

               âœ… ì‹¤ë¬´ ìƒí™©ë³„ ì •ë¦¬í‘œ
               ğŸ” ì™¸ë¶€ ì‚¬ì´íŠ¸ë¡œ ë‚˜ê°€ëŠ” ìƒˆ ì°½ ë§í¬ (<a href="...">)
                  :  noopener	/ íƒ­ ë‚©ì¹˜ ë°©ì§€. ì™¸ë¶€ì—ì„œ ë‚´ íƒ­ ì¡°ì‘ ëª»í•˜ê²Œ í•¨.
               ğŸ” ì™¸ë¶€ ì‚¬ì´íŠ¸ë¡œ ê°€ë˜ ë‚´ URLì„ ìˆ¨ê¸°ê³  ì‹¶ìŒ	
                  : noreferrer / Referer ì œê±° + opener ì œê±°. ê°œì¸ì •ë³´ ë³´í˜¸.
               ğŸ“Š ìœ ì… ê²½ë¡œ ë¶„ì„(GA ë“±) í•„ìš”
                  :noopener / openerëŠ” ì œê±°í•˜ë˜, RefererëŠ” ìœ ì§€í•´ì•¼ ë¶„ì„ ê°€ëŠ¥.
                            ì‚¬ë‚´ ì‹œìŠ¤í…œ ë˜ëŠ” ë¯¼ê°í•œ ê²½ë¡œì—ì„œ ì™¸ë¶€ë¡œ ì´ë™í•  ë•Œ	noreferrer	ë‚´ ì‹œìŠ¤í…œ ì£¼ì†Œ ë…¸ì¶œ ë§‰ê¸° (ex: ì¸ì¦ í† í° í¬í•¨ URL).
               ğŸ§© iframe ì•ˆì—ì„œ Viewer ë“± ì½˜í…ì¸  ì¶œë ¥
                  : noopener ë˜ëŠ” ì—†ìŒ / noreferrerëŠ” ë§í¬ ì‘ë™ì•ˆí•  ìˆ˜ ìˆìŒ (ì£¼ì˜).
               ğŸ“š ìœ„ì ¯, ì„ë² ë“œ ì½”ë“œ, ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œë¬¼ ë“± ìœ ì € ì½˜í…ì¸ ì— í¬í•¨ëœ ë§í¬
                  : noopener noreferrer / ë³´ì•ˆ ìµœìš°ì„ . ìœ ì € ì½˜í…ì¸ ëŠ” í•­ìƒ ìœ„í—˜ ê°€ëŠ¥ì„± ìˆìŒ.
               âœ… ë‚´ë¶€ ë§í¬ (<a href="/about">)
                  : ì—†ìŒ / ê°™ì€ ë„ë©”ì¸ì´ë¯€ë¡œ opener ë¬¸ì œ ì—†ìŒ. ì„±ëŠ¥ìƒ ë¶ˆí•„ìš”.

            */
            if (node.tagName === 'A') {
               node.setAttribute('rel', 'noreferrer');
            }
         });
         let imageEditor = null;
         const { Editor } = toastui;
         const { tableMergedCell, codeSyntaxHighlight, colorSyntax } = Editor.plugin;

         // ì´ë¯¸ì§€ ì—ë””í„° ë¯¸ë¦¬ ë§Œë“¤ì–´ë†“ê¸°
         const container = document.getElementById('image-editor-container');
         imageEditor = new tui.ImageEditor(container, {
            includeUI: {
               loadImage: {
                  path: '', // ì´ˆê¸°ì—” ë¹„ì›Œë‘ê³ , ë‚˜ì¤‘ì— ì´ë¯¸ì§€ë§Œ ë³€ê²½
                  name: '',
               },
               menu: ['crop', 'flip', 'rotate', 'draw', 'shape', 'text'],
               initMenu: 'crop',
               uiSize: {
                  width: '1000px',
                  height: '700px',
               },
               menuBarPosition: 'bottom',
            },
            cssMaxWidth: 700,
            cssMaxHeight: 500,
            selectionStyle: {
               cornerSize: 20,
               rotatingPointOffset: 70,
            },
         });

         const editor = new Editor({
            el: document.querySelector('#editor'),
            height: '500px',
            initialEditType: 'wysiwyg',
            previewStyle: 'vertical',
            language: 'ko-KR',
            initialValue: '',
            plugins: [tableMergedCell, codeSyntaxHighlight, colorSyntax],
            customHTMLSanitizer: (html) => {
               return DOMPurify.sanitize(html);
            },

            // addImageBlobHook : ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¡œì§ ì»¤ìŠ¤í…€
            /*
               ì°¸ê³  ë§í¬
               1) ìë°”ë¡œ ë””ìŠ¤í¬ì— ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥í•˜ê³  ë¶ˆëŸ¬ì˜¤ê¸° : https://congsong.tistory.com/68#3.-addimageblobhook%EC%9C%BC%EB%A1%9C%C2%A0%EC%9D%B4%EB%AF%B8%EC%A7%80%C2%A0%EC%97%85%EB%A1%9C%EB%93%9C%C2%A0%EB%A1%9C%EC%A7%81%C2%A0%EC%BB%A4%EC%8A%A4%ED%85%80%ED%95%98%EA%B8%B0
               2) ì´ë¯¸ì§€ ì²¨ë¶€ë¡œì§ì„ base64 ì—ì„œ íŒŒì¼ ê°ì²´ë¥¼ S3ì— ì €ì¥í•˜ê³  S3 url ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ëŠ” ë°©ë²• : https://leego.tistory.com/entry/Toast-UI-Editor-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B2%A8%EB%B6%80%ED%95%98%EA%B8%B0
            */
            hooks: {
               async addImageBlobHook(blob, callback) {
                  /*
                           1. blob
                           : ì—…ë¡œë“œëœ ì´ë¯¸ì§€ì˜ ì •ë³´ë¥¼ ê°€ì§„ íŒŒì¼ ê°ì²´ë¡œ, ë‚ ì§œ/ì´ë¦„/ì‚¬ì´ì¦ˆ/íƒ€ì… ë“±ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìŒ.

                           2. callback
                           : ì—ë””í„° ë‚´ë¶€ ì‹¤í–‰ ë¡œì§ì˜ ì¼ë¶€ì¸ í•¨ìˆ˜(ì•„ë˜ ì½”ë“œ)ê°€ ë°˜í™˜ë˜ëŠ”ë°, í˜¸ì¶œ ì‹œ ì—ë””í„°ì— ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ëŠ” ì—­í• ì„ í•¨

                           this.props.eventEmitter.emit("addImageBlobHook", o, (function(e, r) {
                               return t.props.execCommand("addImage", {
                                   imageUrl: e,
                                   altText: r || n.value
                               })
                           }
                           ), "ui")
                        */

                  // ì„œë²„ì— ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  ê²½ìš°
                  /*
                        try {
                           // 1. ì—ë””í„°ì— ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¥¼ FormData ê°ì²´ì— ì €ì¥
                           // (ì´ë•Œ, ì»¨íŠ¸ë¡¤ëŸ¬ uploadEditorImage ë©”ì„œë“œì˜ íŒŒë¼ë¯¸í„°ì¸ 'image'ì™€ formDataì— append í•˜ëŠ” key('image')ê°’ì€ ë™ì¼í•´ì•¼ í•¨)

                           const formData = new FormData();
                           formData.append('image', blob);

                           // 2. FileApiController - uploadEditorImage ë©”ì„œë“œ í˜¸ì¶œ
                           const response = await fetch('./img', {
                              method: 'POST',
                              body: formData,
                           });

                           // 3. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì „ë‹¬ë°›ì€ ë””ìŠ¤í¬ì— ì €ì¥ëœ íŒŒì¼ëª…
                           const filename = await response.text();
                           console.log('ì„œë²„ì— ì €ì¥ëœ íŒŒì¼ëª… : ', filename);

                           // 4. addImageBlobHookì˜ callback í•¨ìˆ˜ë¥¼ í†µí•´, ë””ìŠ¤í¬ì— ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì—ë””í„°ì— ë Œë”ë§
                           const imageUrl = `./img/image-print?filename=${filename}`;
                           callback(imageUrl, 'image alt attribute');
                        } catch (error) {
                           console.error('ì—…ë¡œë“œ ì‹¤íŒ¨ : ', error);
                        }
                     */

                  // viewerì— ì œëŒ€ë¡œ ë“¤ì–´ê°€ëŠ”ì§€ í…ŒìŠ¤íŠ¸, base64ë¡œ ì¸ì½”ë”©í•´ì„œ ë§ˆí¬ë‹¤ìš´ìœ¼ë¡œ ì‚½ì…(ë¹„ì¶”ì²œ ìš©ëŸ‰ì¦ê°€)

                  /* 1) ê°„ë‹¨í•œ ë²„ì „
                     const reader = new FileReader();

                     reader.onload = () => {
                        const dataUrl = reader.result; // base64 ì¸ì½”ë”©ëœ ì´ë¯¸ì§€ URL
                        callback(dataUrl, 'image alt attribute', 'markdown');
                     };

                     reader.readAsDataURL(blob); // base64ë¡œ ë³€í™˜
                     */
                  /* 2) toast image editor ì—°ê²° */
                  // blobì„ base64ë¡œ ë³€í™˜
                  const reader = new FileReader();
                  reader.onload = () => {
                     const container = document.getElementById('image-editor-container');
                     if (container) container.style.display = 'block';

                     if (imageEditor && imageEditor.ui) {
                        imageEditor.ui._editorCallback = callback;
                        imageEditor.ui._imageEditorInstance = imageEditor;
                        imageEditor.ui._containerElement = container;
                     }

                     imageEditor.ui._addDownloadEvent();

                     imageEditor.loadImageFromURL(reader.result, 'í¸ì§‘ ì´ë¯¸ì§€').then(() => {
                        imageEditor.clearUndoStack();
                        imageEditor.clearRedoStack();
                     });
                  };
                  reader.readAsDataURL(blob);
               },
            },
         });
         document.getElementById('send').addEventListener('click', () => {
            const dirty = editor.getMarkdown();
            const sanitized = encodeURIComponent(DOMPurify.sanitize(dirty));
            /*const content = DOMPurify.sanitize(dirty);

            const viewer = new Editor.factory({
               el: document.querySelector('#viewer'),
               height: '500px',
               viewer: true,
               initialValue: content,
               plugins: [tableMergedCell, codeSyntaxHighlight, colorSyntax],
            });*/

            /*
               <<  iframe sandbox ì„¤ì • >>

               âœ… sandbox ì˜µì…˜ ìƒì„¸ ëª©ë¡
                  1. allow-scripts : JS ì‹¤í–‰ í—ˆìš© (Viewer ì‘ë™ì— í•„ìˆ˜)
                  2. allow-same-origin : iframe ë‚´ë¶€ JSì—ì„œ document.cookie, localStorage ë“± ë™ì¼ ì¶œì²˜ ì ‘ê·¼ í—ˆìš©
                  3. allow-forms : <form> ì œì¶œ í—ˆìš©
                  4. allow-popups : window.open() ê°€ëŠ¥
                  5. allow-modals : alert(), confirm(), prompt() ì‚¬ìš© ê°€ëŠ¥
                  6. allow-presentation : í”„ë ˆì  í…Œì´ì…˜ API í—ˆìš© (ì˜ ì•ˆ ì”€)
                  7. allow-downloads : <a download> í—ˆìš©
                  8. allow-top-navigation: iframe ì•ˆì—ì„œ window.top.location ë³€ê²½ ê°€ëŠ¥ (ìœ„í—˜!)
                  9. allow-top-navigation-by-user-activation : ìœ ì € í´ë¦­ ì‹œë§Œ ìƒìœ„ í˜ì´ì§€ ì´ë™ ê°€ëŠ¥
               
               ğŸ” ê³ ê¸‰ ì„¤ì • ì¶”ì²œ: ìµœì†Œ ê¶Œí•œ ì¡°í•©

               1) ê°€ì¥ ì¶”ì²œí•˜ëŠ” ë³´ì•ˆ ì„¤ì •
                  sandbox="allow-scripts allow-same-origin"
               : iframe ì•ˆì—ì„œ form ì œì¶œ, window.open(), íŒì—…(alert, confirm ë“±), ìƒìœ„ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ì´ ë¶ˆê°€ëŠ¥í•´ì§€ê³  â¡ï¸ ì½˜í…ì¸  ë Œë”ë§ë§Œ ê°€ëŠ¥í•˜ê²Œ ì œí•œ.
               
               2) ë§Œì•½ viewer ì•ˆì—ì„œ íŠ¹ì • ê¸°ëŠ¥ì´ í•„ìš”í•˜ë‹¤ë©´
                  a. ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ í•„ìš”í•  ë•Œ: sandbox="allow-scripts allow-same-origin allow-downloads"
                  b. Viewer ë‚´ë¶€ì—ì„œ ë§í¬ ì—´ê¸°(window.open ë“±) í—ˆìš©: sandbox="allow-scripts allow-same-origin allow-popups"
                  c. alert/prompt ì‚¬ìš© í•„ìš”í•  ë•Œ: sandbox="allow-scripts allow-same-origin allow-modals"
               
               âœ… ì™œ ì•ˆì „í•œê°€?
               â–¶ 1. sandboxê°€ iframeì„ "ê°ì˜¥"ì²˜ëŸ¼ ë§Œë“­ë‹ˆë‹¤
                  sandbox="allow-scripts allow-same-origin" ì„¤ì •ì„ ì£¼ë©´:
                  âŒ ë¶€ëª¨ í˜ì´ì§€ì˜ DOM ì ‘ê·¼ ë¶ˆê°€	window.parent, top, opener ë“±ì— ì ‘ê·¼ ë¶ˆê°€
                  âŒ ì¿ í‚¤, localStorage ê³µìœ  ì•ˆ ë¨	ë…ë¦½ëœ originì²˜ëŸ¼ ì‘ë™ (ë™ì¼ ë„ë©”ì¸ì´ì–´ë„ ì•ˆì „)
                  âŒ ë¶€ëª¨ í˜ì´ì§€ ë¦¬ë””ë ‰ì…˜ ë¶ˆê°€	top.location = ... ì°¨ë‹¨ë¨
                  âŒ JS ì‹¤í–‰ì€ iframe ì•ˆì—ì„œë§Œ	viewer ë‚´ë¶€ì˜ scriptë§Œ ì‹¤í–‰ë¨
                  âœ… XSS ì‹¤í–‰ë˜ë”ë¼ë„ ê²©ë¦¬ë¨	ê³µê²©ìëŠ” iframe ë‚´ë¶€ì—ì„œë§Œ ì˜í–¥ ê°€ëŠ¥

                  ğŸ’¡ ì¦‰, ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ê°€ viewer ì•ˆì—ì„œ ì‹¤í–‰ëœë‹¤ í•´ë„, viewer ë°”ê¹¥ì—ëŠ” ì ˆëŒ€ ëª» ë²—ì–´ë‚˜ìš”.

               â–¶ 2. DOMPurifyë¡œ 1ì°¨ ë°©ì–´
                  ì•…ì„± HTML, <script>, onerror, javascript: ë“± ëŒ€ë¶€ë¶„ í•„í„°ë§
                  
                  ì˜ˆì™¸ì ìœ¼ë¡œ ëš«ë¦´ ìˆ˜ ìˆëŠ” style="expression(...)" ë“±ë„ hookìœ¼ë¡œ ì œê±°
                  
                  â†’ XSSë¥¼ ê±°ì˜ ì›ì²œ ì°¨ë‹¨
            */
            const viewer = document.getElementById('viewer');
            viewer.innerHTML = ''; // ì´ˆê¸°í™”

            const frame = document.createElement('iframe');
            frame.id = 'viewerFrame';
            frame.setAttribute('sandbox', 'allow-scripts allow-popups allow-same-origin allow-top-navigation-by-user-activation');
            // ì™„ì „íˆ ë‹¤ë¥¸ ì„œë²„ë¥¼ ê°€ì ¸ì™€ì„œ viewer.html ì„ ë„ìš´ ë‹¤ìŒ allow-same-originì†ì„±ì„ ë¹¼ëŠ” ê²ƒì´ ì•ˆì „(í˜„ì¬ liver-serverëŠ” ìë™ìœ¼ë¡œ ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¶”ê°€í•´ì„œ ì–´ì©”ìˆ˜ ì—†ìŒ)
            frame.src = `./pages/viewer.html`;

            viewer.appendChild(frame);

            frame.onload = () => {
               frame.contentWindow.postMessage(
                  {
                     type: 'render',
                     content: sanitized,
                  },
                  '*'
               );
            };
         });
      </script>
   </body>
</html>
